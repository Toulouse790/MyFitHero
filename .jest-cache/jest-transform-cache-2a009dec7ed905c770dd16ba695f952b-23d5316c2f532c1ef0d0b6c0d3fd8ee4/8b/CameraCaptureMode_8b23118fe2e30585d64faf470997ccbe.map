{"version":3,"names":["react_1","cov_23z57rdz9c","s","__importStar","require","lucide_react_1","button_1","CameraCaptureMode","isCapturing","onCapture","onCancel","onError","f","videoRef","useRef","canvasRef","stream","setStream","useState","isMobile","test","navigator","userAgent","useEffect","b","startCamera","stopCamera","mediaStream","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","current","srcObject","play","error","console","message","type","getTracks","forEach","track","stop","capturePhoto","canvas","context","getContext","videoWidth","videoHeight","drawImage","toBlob","blob","file","File","jsx_runtime_1","jsxs","className","children","jsx","ref","autoPlay","muted","playsInline","style","maxHeight","Button","onClick","size","Camera","variant","X","exports","default"],"sources":["/workspaces/MyFitHero/src/features/nutrition/components/CameraCaptureMode.tsx"],"sourcesContent":["// src/features/nutrition/components/CameraCaptureMode.tsx\nimport React, { useRef, useState, useEffect } from 'react';\nimport { Camera, X } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ninterface CameraCaptureModeProps {\n  isCapturing: boolean;\n  onCapture: (file: File) => void;\n  onCancel: () => void;\n  onError: (error: { message: string; type: string }) => void;\n}\n\nexport const CameraCaptureMode: React.FC<CameraCaptureModeProps> = ({\n  isCapturing,\n  onCapture,\n  onCancel,\n  onError,\n}) => {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [stream, setStream] = useState<MediaStream | null>(null);\n\n  // Détection mobile pour utiliser la caméra arrière\n  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n\n  // Démarrer la caméra quand le mode est activé\n  useEffect(() => {\n    if (isCapturing) {\n      startCamera();\n    } else {\n      stopCamera();\n    }\n\n    return () => {\n      stopCamera();\n    };\n  }, [isCapturing]);\n\n  const startCamera = async () => {\n    try {\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: isMobile ? 'environment' : 'user', // Caméra arrière sur mobile\n          width: { ideal: 1280 },\n          height: { ideal: 720 }\n        }\n      });\n\n      setStream(mediaStream);\n      \n      if (videoRef.current) {\n        videoRef.current.srcObject = mediaStream;\n        videoRef.current.play();\n      }\n    } catch (error: any) {\n      console.error('Camera error:', error);\n      onError({\n        message: 'Impossible d\\'accéder à la caméra',\n        type: 'camera'\n      });\n    }\n  };\n\n  const stopCamera = () => {\n    if (stream) {\n      stream.getTracks().forEach(track => track.stop());\n      setStream(null);\n    }\n    \n    if (videoRef.current) {\n      videoRef.current.srcObject = null;\n    }\n  };\n\n  const capturePhoto = () => {\n    if (!videoRef.current || !canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const video = videoRef.current;\n    const context = canvas.getContext('2d');\n\n    if (!context) return;\n\n    // Définir les dimensions\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n\n    // Dessiner l'image du video sur le canvas\n    context.drawImage(video, 0, 0);\n\n    // Convertir en blob et déclencher le callback\n    canvas.toBlob((blob) => {\n      if (blob) {\n        const file = new File([blob], 'camera-capture.jpg', { type: 'image/jpeg' });\n        onCapture(file);\n      }\n    }, 'image/jpeg', 0.8);\n  };\n\n  if (!isCapturing) {\n    return null;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"relative\">\n        <video\n          ref={videoRef}\n          className=\"w-full rounded-lg bg-gray-100\"\n          autoPlay\n          muted\n          playsInline\n          style={{ maxHeight: '400px' }}\n        />\n        <canvas ref={canvasRef} className=\"hidden\" />\n        \n        {/* Overlay pour aide visuelle */}\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n          <div className=\"border-2 border-white rounded-lg w-48 h-48 opacity-50\" />\n        </div>\n      </div>\n      \n      <div className=\"flex gap-3 justify-center\">\n        <Button onClick={capturePhoto} size=\"lg\" className=\"px-8\">\n          <Camera className=\"w-5 h-5 mr-2\" />\n          Capturer\n        </Button>\n        <Button onClick={onCancel} variant=\"outline\" size=\"lg\">\n          <X className=\"w-5 h-5 mr-2\" />\n          Annuler\n        </Button>\n      </div>\n\n      <div className=\"text-center text-sm text-gray-600\">\n        <p>Centrez l'aliment dans le cadre et appuyez sur Capturer</p>\n      </div>\n    </div>\n  );\n};\n\nexport default CameraCaptureMode;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}