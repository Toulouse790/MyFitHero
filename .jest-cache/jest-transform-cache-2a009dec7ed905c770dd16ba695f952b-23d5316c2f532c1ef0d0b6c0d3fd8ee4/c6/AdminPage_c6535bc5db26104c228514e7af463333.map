{"version":3,"names":["react_1","cov_2kwdy6wrti","s","__importStar","require","wouter_1","components_1","useAuthStatus_1","supabase_1","use_toast_1","Admin","f","setLocation","useLocation","session","loading","isAuthenticated","useAuthStatus","toast","useToast","userProfile","setUserProfile","useState","profileLoading","setProfileLoading","fetchUserProfile","userId","data","error","supabase","from","select","eq","single","b","console","useEffect","checkAdminAccess","user","profile","id","title","description","variant","role","jsx_runtime_1","jsxs","className","children","jsx","AdminDashboard","exports","default"],"sources":["/workspaces/MyFitHero/src/features/admin/pages/AdminPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n// client/src/pages/Admin.tsx\nimport { useLocation } from 'wouter';\nimport { AdminDashboard } from '@/features/admin/components';\nimport { useAuthStatus } from '@/features/auth/hooks/useAuthStatus';\nimport { supabase } from '@/lib/supabase';\nimport { useToast } from '@/shared/hooks/use-toast';\n\ninterface UserProfile {\n  id: string;\n  role: string;\n  email?: string;\n}\n\nconst Admin: React.FC = () => {\n  const [, setLocation] = useLocation();\n  const { session, loading, isAuthenticated } = useAuthStatus();\n  const { toast } = useToast();\n\n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\n  const [profileLoading, setProfileLoading] = useState(true);\n\n  // R√©cup√©rer le profil utilisateur avec le r√¥le\n  const fetchUserProfile = async (userId: string) => {\n    try {\n      const { data, error }: any = await supabase\n        .from('user_profiles')\n        .select('id, role')\n        .eq('id', userId)\n        .single();\n\n      if (error) {\n        console.error('Erreur r√©cup√©ration profil:', error);\n        return null;\n      }\n\n      return data as UserProfile;\n    } catch (error: any) {\n      console.error('Erreur fetchUserProfile:', error);\n      return null;\n    }\n  };\n\n  useEffect(() => {\n    const checkAdminAccess = async () => {\n      // Si pas encore charg√©, on attend\n      if (loading) return;\n\n      // Si pas authentifi√©, redirection vers auth\n      if (!isAuthenticated) {\n        setLocation('/auth');\n        return;\n      }\n\n      // Si authentifi√© mais pas de session encore (√©tat transitoire), on attend\n      if (!session?.user) {\n        return;\n      }\n\n      // R√©cup√©rer le profil avec le r√¥le\n      setProfileLoading(true);\n      const profile = await fetchUserProfile(session.user.id);\n\n      if (!profile) {\n        toast({\n          title: \"Erreur d'acc√®s\",\n          description: 'Impossible de v√©rifier vos permissions',\n          variant: 'destructive',\n        });\n        setLocation('/');\n        return;\n      }\n\n      setUserProfile(profile);\n\n      // V√©rifier si l'utilisateur est admin\n      if (profile.role !== 'admin') {\n        toast({\n          title: 'Acc√®s refus√©',\n          description: \"Vous n&apos;avez pas les permissions pour acc√©der √† cette page\",\n          variant: 'destructive',\n        });\n        setLocation('/');\n        return;\n      }\n\n      setProfileLoading(false);\n    };\n\n    checkAdminAccess();\n  }, [session, loading, isAuthenticated, setLocation, toast]);\n\n  // Affichage du loader pendant la v√©rification\n  if (loading || profileLoading) {\n    return (\n      <div className=\"flex flex-col items-center justify-center min-h-screen bg-gray-50\">\n        <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4\"></div>\n        <p className=\"text-gray-600 text-sm\">\n          {loading ? \"V√©rification de l&apos;authentification...\" : 'V√©rification des permissions...'}\n        </p>\n        <span className=\"sr-only\">Chargement de la page d&apos;administration</span>\n      </div>\n    );\n  }\n\n  // Si pas authentifi√© ou pas admin, ne rien afficher\n  // (la redirection est d√©j√† en cours)\n  if (!isAuthenticated || !userProfile || userProfile.role !== 'admin') {\n    return null;\n  }\n\n  // Afficher le dashboard admin\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header optionnel pour indiquer le mode admin */}\n      <div className=\"bg-red-600 text-white px-4 py-2 text-center text-sm font-medium\">\n        üîí Mode Administrateur - Acc√®s restreint\n      </div>\n\n      <AdminDashboard />\n    </div>\n  );\n};\n\nexport default Admin;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}