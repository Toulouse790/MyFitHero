{"version":3,"names":["react_1","cov_1rbrhk3cyi","s","__importStar","require","use_toast_1","appStore_1","avatar_1","AvatarUpload","currentAvatar","onAvatarChange","size","b","editable","f","toast","useToast","appStoreUser","updateUserProfile","appStore","isUploading","setIsUploading","useState","previewUrl","setPreviewUrl","displayAvatar","avatar_url","handleFileSelect","file","id","validation","FileValidation","validateImageFile","isValid","title","description","error","variant","preview","createPreviewUrl","uploadAvatar","result","AvatarUploadService","success","avatarUrl","Error","removeAvatar","undefined","jsx_runtime_1","jsxs","className","children","jsx","AvatarPreview","AvatarControls","hasAvatar","onFileSelect","onRemoveAvatar","exports","default"],"sources":["/workspaces/MyFitHero/src/features/profile/components/AvatarUpload.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useToast } from '@/shared/hooks/use-toast';\nimport { appStore } from '@/store/appStore';\nimport { AvatarPreview, AvatarControls, FileValidation, AvatarUploadService } from './avatar';\n\ninterface AvatarUploadProps {\n  currentAvatar?: string;\n  onAvatarChange?: (avatarUrl: string) => void;\n  size?: 'sm' | 'md' | 'lg';\n  editable?: boolean;\n}\n\nconst AvatarUpload: React.FC<AvatarUploadProps> = ({\n  currentAvatar,\n  onAvatarChange,\n  size = 'md',\n  editable = true,\n}) => {\n  const { toast } = useToast();\n  const { appStoreUser, updateUserProfile } = appStore();\n  const [isUploading, setIsUploading] = useState(false);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n\n  const displayAvatar = previewUrl || currentAvatar || appStoreUser?.avatar_url;\n\n  const handleFileSelect = async (file: File) => {\n    if (!appStoreUser?.id) return;\n\n    // Validation du fichier\n    const validation = await FileValidation.validateImageFile(file);\n    if (!validation.isValid) {\n      toast({\n        title: 'Erreur',\n        description: validation.error,\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    try {\n      // Créer un aperçu\n      const preview = await FileValidation.createPreviewUrl(file);\n      setPreviewUrl(preview);\n\n      // Upload du fichier\n      await uploadAvatar(file);\n    } catch (error: any) {\n      toast({\n        title: 'Erreur',\n        description: 'Impossible de traiter l\\'image.',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const uploadAvatar = async (file: File) => {\n    if (!appStoreUser?.id) return;\n\n    setIsUploading(true);\n    try {\n      const result = await AvatarUploadService.uploadAvatar(file, appStoreUser.id);\n\n      if (result.success && result.avatarUrl) {\n        // Mettre à jour le store local\n        updateUserProfile({\n          ...appStoreUser,\n          avatar_url: result.avatarUrl,\n        });\n\n        // Callback pour le parent\n        onAvatarChange?.(result.avatarUrl);\n\n        setPreviewUrl(null);\n        toast({\n          title: 'Photo mise à jour',\n          description: 'Votre photo de profil a été mise à jour avec succès.',\n        });\n      } else {\n        throw new Error(result.error);\n      }\n    } catch (error: any) {\n      setPreviewUrl(null);\n      toast({\n        title: 'Erreur',\n        description: 'Impossible de mettre à jour votre photo.',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const removeAvatar = async () => {\n    if (!appStoreUser?.id) return;\n\n    setIsUploading(true);\n    try {\n      const result = await AvatarUploadService.removeAvatar(appStoreUser.id);\n\n      if (result.success) {\n        // Mettre à jour le store local\n        updateUserProfile({\n          ...appStoreUser,\n          avatar_url: undefined,\n        });\n\n        // Callback pour le parent\n        onAvatarChange?.('');\n\n        toast({\n          title: 'Photo supprimée',\n          description: 'Votre photo de profil a été supprimée.',\n        });\n      } else {\n        throw new Error(result.error);\n      }\n    } catch (error: any) {\n      toast({\n        title: 'Erreur',\n        description: 'Impossible de supprimer votre photo.',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"relative group cursor-pointer\">\n      <AvatarPreview\n        avatarUrl={displayAvatar}\n        size={size}\n        isUploading={isUploading}\n      />\n\n      {editable && (\n        <AvatarControls\n          hasAvatar={!!displayAvatar}\n          isUploading={isUploading}\n          onFileSelect={handleFileSelect}\n          onRemoveAvatar={removeAvatar}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default AvatarUpload;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAA,OAAA;AAAA;AAAA,CAAAC,cAAA,GAAAC,CAAA,QAAAC,YAAA,CAAAC,OAAA;AACA,MAAAC,WAAA;AAAA;AAAA,CAAAJ,cAAA,GAAAC,CAAA,QAAAE,OAAA;AACA,MAAAE,UAAA;AAAA;AAAA,CAAAL,cAAA,GAAAC,CAAA,QAAAE,OAAA;AACA,MAAAG,QAAA;AAAA;AAAA,CAAAN,cAAA,GAAAC,CAAA,QAAAE,OAAA;AAA8F;AAAAH,cAAA,GAAAC,CAAA;AAS9F,MAAMM,YAAY,GAAgCA,CAAC;EACjDC,aAAa;EACbC,cAAc;EACdC,IAAI;EAAA;EAAA,CAAAV,cAAA,GAAAW,CAAA,WAAG,IAAI;EACXC,QAAQ;EAAA;EAAA,CAAAZ,cAAA,GAAAW,CAAA,WAAG,IAAI;AAAA,CAChB,KAAI;EAAA;EAAAX,cAAA,GAAAa,CAAA;EACH,MAAM;IAAEC;EAAK,CAAE;EAAA;EAAA,CAAAd,cAAA,GAAAC,CAAA,QAAG,IAAAG,WAAA,CAAAW,QAAQ,GAAE;EAC5B,MAAM;IAAEC,YAAY;IAAEC;EAAiB,CAAE;EAAA;EAAA,CAAAjB,cAAA,GAAAC,CAAA,QAAG,IAAAI,UAAA,CAAAa,QAAQ,GAAE;EACtD,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC;EAAA;EAAA,CAAApB,cAAA,GAAAC,CAAA,QAAG,IAAAF,OAAA,CAAAsB,QAAQ,EAAC,KAAK,CAAC;EACrD,MAAM,CAACC,UAAU,EAAEC,aAAa,CAAC;EAAA;EAAA,CAAAvB,cAAA,GAAAC,CAAA,QAAG,IAAAF,OAAA,CAAAsB,QAAQ,EAAgB,IAAI,CAAC;EAEjE,MAAMG,aAAa;EAAA;EAAA,CAAAxB,cAAA,GAAAC,CAAA;EAAG;EAAA,CAAAD,cAAA,GAAAW,CAAA,WAAAW,UAAU;EAAA;EAAA,CAAAtB,cAAA,GAAAW,CAAA,WAAIH,aAAa;EAAA;EAAA,CAAAR,cAAA,GAAAW,CAAA,WAAIK,YAAY,EAAES,UAAU;EAAC;EAAAzB,cAAA,GAAAC,CAAA;EAE9E,MAAMyB,gBAAgB,GAAG,MAAOC,IAAU,IAAI;IAAA;IAAA3B,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAC,CAAA;IAC5C,IAAI,CAACe,YAAY,EAAEY,EAAE,EAAE;MAAA;MAAA5B,cAAA,GAAAW,CAAA;MAAAX,cAAA,GAAAC,CAAA;MAAA;IAAA,CAAO;IAAA;IAAA;MAAAD,cAAA,GAAAW,CAAA;IAAA;IAE9B;IACA,MAAMkB,UAAU;IAAA;IAAA,CAAA7B,cAAA,GAAAC,CAAA,QAAG,MAAMK,QAAA,CAAAwB,cAAc,CAACC,iBAAiB,CAACJ,IAAI,CAAC;IAAC;IAAA3B,cAAA,GAAAC,CAAA;IAChE,IAAI,CAAC4B,UAAU,CAACG,OAAO,EAAE;MAAA;MAAAhC,cAAA,GAAAW,CAAA;MAAAX,cAAA,GAAAC,CAAA;MACvBa,KAAK,CAAC;QACJmB,KAAK,EAAE,QAAQ;QACfC,WAAW,EAAEL,UAAU,CAACM,KAAK;QAC7BC,OAAO,EAAE;OACV,CAAC;MAAC;MAAApC,cAAA,GAAAC,CAAA;MACH;IACF,CAAC;IAAA;IAAA;MAAAD,cAAA,GAAAW,CAAA;IAAA;IAAAX,cAAA,GAAAC,CAAA;IAED,IAAI;MACF;MACA,MAAMoC,OAAO;MAAA;MAAA,CAAArC,cAAA,GAAAC,CAAA,QAAG,MAAMK,QAAA,CAAAwB,cAAc,CAACQ,gBAAgB,CAACX,IAAI,CAAC;MAAC;MAAA3B,cAAA,GAAAC,CAAA;MAC5DsB,aAAa,CAACc,OAAO,CAAC;MAEtB;MAAA;MAAArC,cAAA,GAAAC,CAAA;MACA,MAAMsC,YAAY,CAACZ,IAAI,CAAC;IAC1B,CAAC,CAAC,OAAOQ,KAAU,EAAE;MAAA;MAAAnC,cAAA,GAAAC,CAAA;MACnBa,KAAK,CAAC;QACJmB,KAAK,EAAE,QAAQ;QACfC,WAAW,EAAE,iCAAiC;QAC9CE,OAAO,EAAE;OACV,CAAC;IACJ;EACF,CAAC;EAAC;EAAApC,cAAA,GAAAC,CAAA;EAEF,MAAMsC,YAAY,GAAG,MAAOZ,IAAU,IAAI;IAAA;IAAA3B,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAC,CAAA;IACxC,IAAI,CAACe,YAAY,EAAEY,EAAE,EAAE;MAAA;MAAA5B,cAAA,GAAAW,CAAA;MAAAX,cAAA,GAAAC,CAAA;MAAA;IAAA,CAAO;IAAA;IAAA;MAAAD,cAAA,GAAAW,CAAA;IAAA;IAAAX,cAAA,GAAAC,CAAA;IAE9BmB,cAAc,CAAC,IAAI,CAAC;IAAC;IAAApB,cAAA,GAAAC,CAAA;IACrB,IAAI;MACF,MAAMuC,MAAM;MAAA;MAAA,CAAAxC,cAAA,GAAAC,CAAA,QAAG,MAAMK,QAAA,CAAAmC,mBAAmB,CAACF,YAAY,CAACZ,IAAI,EAAEX,YAAY,CAACY,EAAE,CAAC;MAAC;MAAA5B,cAAA,GAAAC,CAAA;MAE7E;MAAI;MAAA,CAAAD,cAAA,GAAAW,CAAA,WAAA6B,MAAM,CAACE,OAAO;MAAA;MAAA,CAAA1C,cAAA,GAAAW,CAAA,WAAI6B,MAAM,CAACG,SAAS,GAAE;QAAA;QAAA3C,cAAA,GAAAW,CAAA;QAAAX,cAAA,GAAAC,CAAA;QACtC;QACAgB,iBAAiB,CAAC;UAChB,GAAGD,YAAY;UACfS,UAAU,EAAEe,MAAM,CAACG;SACpB,CAAC;QAEF;QAAA;QAAA3C,cAAA,GAAAC,CAAA;QACAQ,cAAc,GAAG+B,MAAM,CAACG,SAAS,CAAC;QAAC;QAAA3C,cAAA,GAAAC,CAAA;QAEnCsB,aAAa,CAAC,IAAI,CAAC;QAAC;QAAAvB,cAAA,GAAAC,CAAA;QACpBa,KAAK,CAAC;UACJmB,KAAK,EAAE,mBAAmB;UAC1BC,WAAW,EAAE;SACd,CAAC;MACJ,CAAC,MAAM;QAAA;QAAAlC,cAAA,GAAAW,CAAA;QAAAX,cAAA,GAAAC,CAAA;QACL,MAAM,IAAI2C,KAAK,CAACJ,MAAM,CAACL,KAAK,CAAC;MAC/B;IACF,CAAC,CAAC,OAAOA,KAAU,EAAE;MAAA;MAAAnC,cAAA,GAAAC,CAAA;MACnBsB,aAAa,CAAC,IAAI,CAAC;MAAC;MAAAvB,cAAA,GAAAC,CAAA;MACpBa,KAAK,CAAC;QACJmB,KAAK,EAAE,QAAQ;QACfC,WAAW,EAAE,0CAA0C;QACvDE,OAAO,EAAE;OACV,CAAC;IACJ,CAAC,SAAS;MAAA;MAAApC,cAAA,GAAAC,CAAA;MACRmB,cAAc,CAAC,KAAK,CAAC;IACvB;EACF,CAAC;EAAC;EAAApB,cAAA,GAAAC,CAAA;EAEF,MAAM4C,YAAY,GAAG,MAAAA,CAAA,KAAW;IAAA;IAAA7C,cAAA,GAAAa,CAAA;IAAAb,cAAA,GAAAC,CAAA;IAC9B,IAAI,CAACe,YAAY,EAAEY,EAAE,EAAE;MAAA;MAAA5B,cAAA,GAAAW,CAAA;MAAAX,cAAA,GAAAC,CAAA;MAAA;IAAA,CAAO;IAAA;IAAA;MAAAD,cAAA,GAAAW,CAAA;IAAA;IAAAX,cAAA,GAAAC,CAAA;IAE9BmB,cAAc,CAAC,IAAI,CAAC;IAAC;IAAApB,cAAA,GAAAC,CAAA;IACrB,IAAI;MACF,MAAMuC,MAAM;MAAA;MAAA,CAAAxC,cAAA,GAAAC,CAAA,QAAG,MAAMK,QAAA,CAAAmC,mBAAmB,CAACI,YAAY,CAAC7B,YAAY,CAACY,EAAE,CAAC;MAAC;MAAA5B,cAAA,GAAAC,CAAA;MAEvE,IAAIuC,MAAM,CAACE,OAAO,EAAE;QAAA;QAAA1C,cAAA,GAAAW,CAAA;QAAAX,cAAA,GAAAC,CAAA;QAClB;QACAgB,iBAAiB,CAAC;UAChB,GAAGD,YAAY;UACfS,UAAU,EAAEqB;SACb,CAAC;QAEF;QAAA;QAAA9C,cAAA,GAAAC,CAAA;QACAQ,cAAc,GAAG,EAAE,CAAC;QAAC;QAAAT,cAAA,GAAAC,CAAA;QAErBa,KAAK,CAAC;UACJmB,KAAK,EAAE,iBAAiB;UACxBC,WAAW,EAAE;SACd,CAAC;MACJ,CAAC,MAAM;QAAA;QAAAlC,cAAA,GAAAW,CAAA;QAAAX,cAAA,GAAAC,CAAA;QACL,MAAM,IAAI2C,KAAK,CAACJ,MAAM,CAACL,KAAK,CAAC;MAC/B;IACF,CAAC,CAAC,OAAOA,KAAU,EAAE;MAAA;MAAAnC,cAAA,GAAAC,CAAA;MACnBa,KAAK,CAAC;QACJmB,KAAK,EAAE,QAAQ;QACfC,WAAW,EAAE,sCAAsC;QACnDE,OAAO,EAAE;OACV,CAAC;IACJ,CAAC,SAAS;MAAA;MAAApC,cAAA,GAAAC,CAAA;MACRmB,cAAc,CAAC,KAAK,CAAC;IACvB;EACF,CAAC;EAAC;EAAApB,cAAA,GAAAC,CAAA;EAEF,OACE,IAAA8C,aAAA,CAAAC,IAAA;IAAKC,SAAS,EAAC,+BAA+B;IAAAC,QAAA,GAC5C,IAAAH,aAAA,CAAAI,GAAA,EAAC7C,QAAA,CAAA8C,aAAa;MACZT,SAAS,EAAEnB,aAAa;MACxBd,IAAI,EAAEA,IAAI;MACVS,WAAW,EAAEA;IAAW,EACxB;IAED;IAAA,CAAAnB,cAAA,GAAAW,CAAA,WAAAC,QAAQ;IAAA;IAAA,CAAAZ,cAAA,GAAAW,CAAA,WACP,IAAAoC,aAAA,CAAAI,GAAA,EAAC7C,QAAA,CAAA+C,cAAc;MACbC,SAAS,EAAE,CAAC,CAAC9B,aAAa;MAC1BL,WAAW,EAAEA,WAAW;MACxBoC,YAAY,EAAE7B,gBAAgB;MAC9B8B,cAAc,EAAEX;IAAY,EAC5B,CACH;EAAA,EACG;AAEV,CAAC;AAAC;AAAA7C,cAAA,GAAAC,CAAA;AAEFwD,OAAA,CAAAC,OAAA,GAAenD,YAAY","ignoreList":[]}