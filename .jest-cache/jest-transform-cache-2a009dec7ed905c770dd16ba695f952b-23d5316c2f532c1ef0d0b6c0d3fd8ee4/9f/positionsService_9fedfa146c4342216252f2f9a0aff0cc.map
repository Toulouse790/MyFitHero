{"version":3,"names":["supabase_1","cov_1wcocwp1q5","s","require","CACHE_TTL","__MEMO_KEY","memoryCache","PositionService","getPositionsFromLibrary","sportId","f","cache","b","expiry","Date","now","data","_data","error","_error","supabase","from","select","eq","single","console","positions","getPositionsFromDrills","sportName","neq","Array","Set","map","r","position","filter","Boolean","clearCache","exports"],"sources":["/workspaces/MyFitHero/src/shared/utils/positionsService.ts"],"sourcesContent":["// client/src/services/positionService.ts\nimport { supabase } from '@/lib/supabase';\n\nconst CACHE_TTL = 5 * 60_000;\nconst __MEMO_KEY = 'positions-cache-v1';\nlet memoryCache: { [sportId: string]: { data: string[]; expiry: number } } = {};\n\nexport class PositionService {\n  // Récupère les positions depuis le champ ARRAY de sports_library\n  static async getPositionsFromLibrary(sportId: number): Promise<string[]> {\n    const cache = memoryCache[sportId];\n    if (cache && cache.expiry > Date.now()) return cache.data;\n\n    const { data: _data, error: _error } = await supabase\n      .from('sports_library')\n      .select('positions')\n      .eq('id', sportId)\n      .single();\n\n    if (error || !data) {\n      console.error('getPositionsFromLibrary:', error);\n      return [];\n    }\n    const positions = data.positions ?? [];\n    memoryCache[sportId] = { data: positions, expiry: Date.now() + CACHE_TTL };\n    return positions;\n  }\n\n  // Bonus : extraire les positions uniques depuis sport_drills_library\n  static async getPositionsFromDrills(sportName: string): Promise<string[]> {\n    const cache = memoryCache[`drills_${sportName}`];\n    if (cache && cache.expiry > Date.now()) return cache.data;\n\n    const { data: _data, error: _error } = await supabase\n      .from('sport_drills_library')\n      .select('position')\n      .eq('sport', sportName)\n      .neq('position', null);\n\n    if (error || !data) {\n      console.error('getPositionsFromDrills:', error);\n      return [];\n    }\n    const positions = Array.from(new Set(data.map(r => r.position!).filter(Boolean)));\n    memoryCache[`drills_${sportName}`] = { data: positions, expiry: Date.now() + CACHE_TTL };\n    return positions;\n  }\n\n  static clearCache() {\n    memoryCache = {};\n  }\n}\n"],"mappings":"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","ignoreList":[]}