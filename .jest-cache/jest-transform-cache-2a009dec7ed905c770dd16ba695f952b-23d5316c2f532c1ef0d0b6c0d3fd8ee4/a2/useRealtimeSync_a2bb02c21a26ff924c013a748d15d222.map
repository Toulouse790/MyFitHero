{"version":3,"names":["cov_y5phsm76","actualCoverage","s","react_1","require","supabase_1","appStore_1","useRealtimeSync","pillar","onUpdate","onInsert","onDelete","f","channelRef","useRef","appStoreUser","appStore","useEffect","id","b","tableMap","hydration","nutrition","sleep","workout","table","channelName","current","supabase","channel","on","event","schema","filter","payload","enrichedPayload","userId","new","user_id","old","eventType","subscribe","removeChannel","isConnected","exports"],"sources":["/workspaces/MyFitHero/src/features/workout/hooks/useRealtimeSync.ts"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\n// client/src/hooks/useRealtimeSync.ts\nimport { supabase } from '@/lib/supabase';\nimport { appStore } from '@/store/appStore';\n\ninterface RealtimeSyncOptions {\n  pillar: 'hydration' | 'nutrition' | 'sleep' | 'workout';\n  onUpdate?: (payload: any) => void;\n  onInsert?: (payload: any) => void;\n  onDelete?: (payload: any) => void;\n}\n\nexport const useRealtimeSync = ({ pillar, onUpdate, onInsert, onDelete }: RealtimeSyncOptions) => {\n  const channelRef = useRef<any>(null);\n  const { appStoreUser } = appStore();\n\n  useEffect(() => {\n    if (!appStoreUser?.id) return;\n\n    // Table mapping for each pillar\n    const tableMap = {\n      hydration: 'hydration_logs',\n      nutrition: 'meals',\n      sleep: 'sleep_sessions',\n      workout: 'workout_sessions',\n    };\n\n    const table = tableMap[pillar];\n    const channelName = `${pillar}-${appStoreUser.id}`;\n\n    // Create channel\n    channelRef.current = supabase\n      .channel(channelName)\n      .on(\n        'postgres_changes',\n        {\n          event: '*',\n          schema: 'public',\n          table,\n          filter: `user_id=eq.${appStoreUser.id}`,\n        },\n        payload => {\n\n          // Add userId to payload for identification\n          const enrichedPayload = {\n            ...payload,\n            userId: payload.new?.user_id || payload.old?.user_id,\n          };\n\n          switch (payload.eventType) {\n            case 'INSERT':\n              onInsert?.(enrichedPayload);\n              onUpdate?.(enrichedPayload);\n              break;\n            case 'UPDATE':\n              onUpdate?.(enrichedPayload);\n              break;\n            case 'DELETE':\n              onDelete?.(enrichedPayload);\n              onUpdate?.(enrichedPayload);\n              break;\n          }\n        }\n      )\n      .subscribe();\n\n    // Cleanup\n    return () => {\n      if (channelRef.current) {\n        supabase.removeChannel(channelRef.current);\n      }\n    };\n  }, [appStoreUser?.id, pillar, onUpdate, onInsert, onDelete]);\n\n  return {\n    isConnected: !!channelRef.current,\n  };\n};\n"],"mappings":"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","ignoreList":[]}