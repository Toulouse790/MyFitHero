{"version":3,"names":["exports","useAuth","react_1","cov_1g526hoxxk","s","__importStar","require","supabase_1","f","user","setUser","useState","isLoading","setIsLoading","fetchUser","useCallback","data","session","supabase","auth","getSession","b","profile","from","select","eq","id","single","useEffect","listener","onAuthStateChange","subscription","unsubscribe","login","email","password","error","_error","signInWithPassword","message","logout","signOut","refresh","isAuthenticated","isAdmin","role","hasCompletedOnboarding","onboarding_completed","default","AuthProvider","children","createElement","Fragment","useRequireAuth","console","warn","useUserProfile"],"sources":["/workspaces/MyFitHero/src/features/auth/hooks/useAuth.ts"],"sourcesContent":["import React, { useState, useEffect, useCallback, ReactNode } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport type { UserProfile } from '@/shared/types/userProfile';\n\nexport interface UseAuthResult {\n  user: UserProfile | undefined;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  isAdmin: boolean;\n  hasCompletedOnboarding: boolean;\n  login: (email: string, password: string) => Promise<{ error?: string }>;\n  logout: () => Promise<void>;\n  refresh: () => Promise<void>;\n}\n\nexport function useAuth(): UseAuthResult {\n  const [user, setUser] = useState<UserProfile | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Récupère la session et le profil utilisateur\n  const fetchUser = useCallback(async () => {\n    setIsLoading(true);\n    const {\n      data: { session },\n    } = await supabase.auth.getSession();\n    if (session?.user) {\n      // Récupère le profil dans Supabase\n      const { data: profile } = await supabase\n        .from('user_profiles')\n        .select('*')\n        .eq('id', session.user.id)\n        .single();\n      setUser(profile || null);\n    } else {\n      setUser(null);\n    }\n    setIsLoading(false);\n  }, []);\n\n  useEffect(() => {\n    fetchUser();\n    // Rafraîchit l'utilisateur à chaque changement de session\n    const { data: listener } = supabase.auth.onAuthStateChange(() => {\n      fetchUser();\n    });\n    return () => {\n      listener?.subscription.unsubscribe();\n    };\n  }, [fetchUser]);\n\n  // Login\n  const login = useCallback(\n    async (email: string, password: string) => {\n      setIsLoading(true);\n      const { error: _error } = await supabase.auth.signInWithPassword({ email, password });\n      await fetchUser();\n      setIsLoading(false);\n      return { error: _error?.message };\n    },\n    [fetchUser]\n  );\n\n  // Logout\n  const logout = useCallback(async () => {\n    setIsLoading(true);\n    await supabase.auth.signOut();\n    setUser(null);\n    setIsLoading(false);\n  }, []);\n\n  // Refresh\n  const refresh = useCallback(async () => {\n    await fetchUser();\n  }, [fetchUser]);\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    isAdmin: user?.role === 'admin',\n    hasCompletedOnboarding: !!user?.onboarding_completed,\n    login,\n    logout,\n    refresh,\n  };\n}\n\nexport default useAuth;\n\n// AuthProvider Component\nexport const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  return React.createElement(React.Fragment, null, children);\n};\n\n// Hook for requiring authentication\nexport const useRequireAuth = () => {\n  const auth = useAuth();\n  \n  useEffect(() => {\n    if (!auth.isLoading && !auth.isAuthenticated) {\n      // Redirect to login or handle unauthorized access\n      console.warn('Authentication required');\n    }\n  }, [auth.isLoading, auth.isAuthenticated]);\n  \n  return auth;\n};\n\n// Alias for useAuth\nexport const useUserProfile = useAuth;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}